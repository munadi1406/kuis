import{j as a}from"./jsx-runtime.B6Q2Q8rY.js";import{p as S,a as z,T as K,b as J,c as V,d as T,e as g,f as X,g as f}from"./generatePdf.Bzozffwp.js";import{D as w,a as B,b as E,c as F,d as k,e as O,f as Y}from"./dialog.C3FXW3zP.js";import{B as d}from"./button.4wA_-35M.js";import{r}from"./index.caxmlYbZ.js";import{L as b,I as P}from"./input.C4_IcoYx.js";import{u as y}from"./useMutation.CWFg6o0r.js";import{l as I,u as Z,B as _}from"./ButtonLoader.B4LbEwmK.js";import{a as m,W as aa}from"./WithQuery.DnMMxJSk.js";import{t as o}from"./use-toast.FdKHRWm9.js";import"./react-icons.esm.Bl5TofSn.js";import"./index.BT_cHE16.js";import"./Combination.bo6dpEKa.js";import"./index.UvFsUNS0.js";import"./index.CxOCE76-.js";import"./useBaseQuery.Dlinqwim.js";const ea=({isDialogOpen:h,setIsDialogOpen:i,data:s,mutate:l})=>{const[x,c]=r.useState();return a.jsx(w,{open:h,onOpenChange:i,children:a.jsxs(B,{className:"sm:max-w-[425px]",children:[a.jsxs(E,{children:[a.jsxs(F,{children:["Edit Mapel ",s.mapel]}),a.jsx(k,{className:"text-red-600 text-xs"})]}),a.jsxs("form",{autoComplete:"false",onSubmit:n=>l.mutate({e:n,id:s.id,mapel:x}),method:"post",children:[a.jsx("div",{className:"grid gap-4 py-4",children:a.jsxs("div",{children:[a.jsx(b,{htmlFor:"email",className:"text-right",children:"Mata Pelajaran"}),a.jsx(P,{id:"email",name:"email",type:"text",className:"col-span-3",onChange:n=>c(n.target.value)})]})}),a.jsx(O,{children:a.jsx(d,{type:"submit",children:"Update Mapel"})})]})]})})};S.fonts=z;const ta=async h=>{const i=await m.get("/api/mapel/all");try{const s={content:[{text:"Daftar Mata Pelajaran",style:"header",alignment:"center",margin:[0,0,0,10]},{table:{headerRows:1,widths:["auto","*","*"],body:[["No","Mata Pelajaran","Created At"],...i.data.data.map(({created_at:l,id:x,mapel:c},n)=>[n+1,c,String(I(l))])]}}],styles:{header:{fontSize:18,bold:!0}}};S.createPdf(s).download("mapel.pdf")}catch(s){console.error("Error generating PDF:",s)}},sa=()=>{const[h,i]=r.useState(!1),[s,l]=r.useState(!1),[x,c]=r.useState(""),[n,L]=r.useState(""),[G,H]=r.useState({id:0,mapel:0}),[v,N]=r.useState(""),{isLoading:U,fetchNextPage:$,hasNextPage:q,isFetchingNextPage:D,data:p,refetch:u}=Z({queryKey:["mapel"],queryFn:async({pageParam:e})=>(await m.get(`/api/mapel?id=${e||0}&search=${v}`)).data,getNextPageParam:e=>e.data.lastId,staleTime:5e3,initialPageParam:0}),{mutate:A}=y({mutationFn:async e=>(e.preventDefault(),await m.post("api/mapel",{mataPelajaran:x})),onSuccess:e=>{u(),i(!1),o({title:"Berhasil",description:"Mata Pelajaran Berhasil Di Tambahkan"})},onError:e=>{L(e.response.data.message),o({title:"Gagal",variant:"destructive",description:"Mata Pelajaran Gagal Di Tambahkan"})}}),Q=y({mutationFn:async e=>await m.delete(`api/mapel?id=${e}`),onSuccess:e=>{u(),o({title:"Berhasil",description:"Mata Pelajaran Berhasil Di Hapus"})},onError:e=>{o({title:"Gagal",variant:"destructive",description:"Mata Pelajaran Gagal Di Hapus"})}}),R=y({mutationFn:async({e,id:t,mapel:j})=>(e.preventDefault(),await m.put("api/mapel",{id:t,mataPelajaran:j})),onSuccess:e=>{u(),l(!1),o({title:"Berhasil",description:"Mata Pelajaran Berhasil Di Update"})},onError:e=>{o({title:"Gagal",variant:"destructive",description:"Mata Pelajaran Gagal Di Update"})}});let M;const W=e=>{const t=e.target.value;t.length>3?(M&&clearTimeout(M),M=setTimeout(async()=>{N(t)},2e3)):N("")};return r.useEffect(()=>{u()},[v]),U?a.jsx(a.Fragment,{children:"Loading..."}):a.jsxs("div",{children:[a.jsxs("div",{className:"w-full flex justify-between items-end  border-b  p-2",children:[a.jsxs("div",{children:[a.jsx(b,{htmlFor:"search",children:"Search"}),a.jsx(P,{type:"search",id:"search",placeholder:"Search",onChange:W})]}),a.jsxs("div",{className:"flex items-end justify-end gap-2",children:[a.jsxs(w,{open:h,onOpenChange:i,children:[a.jsx(Y,{asChild:!0,children:a.jsx(d,{variant:"outline",onClick:()=>i(!0),children:"Buat Mapel"})}),a.jsxs(B,{className:"sm:max-w-[425px]",children:[a.jsxs(E,{children:[a.jsx(F,{children:"Buat Mapel"}),a.jsx(k,{className:"text-red-600 text-xs",children:n})]}),a.jsxs("form",{autoComplete:"false",onSubmit:A,method:"post",children:[a.jsx("div",{className:"grid gap-4 py-4",children:a.jsxs("div",{children:[a.jsx(b,{htmlFor:"email",className:"text-right",children:"Mata Pelajaran"}),a.jsx(P,{id:"email",name:"email",type:"text",className:"col-span-3",onChange:e=>c(e.target.value)})]})}),a.jsx(O,{children:a.jsx(d,{type:"submit",children:"Tambah Mapel"})})]})]})]}),a.jsx(d,{onClick:()=>ta(p.pages),disabled:!p||p.length<=0,children:"Cetak"})]})]}),a.jsxs(K,{children:[a.jsx(J,{children:"Daftar Mata Pelajaran"}),a.jsx(V,{children:a.jsxs(T,{children:[a.jsx(g,{className:"w-[100px]",children:"No"}),a.jsx(g,{children:"Mapel"}),a.jsx(g,{children:"Created At"}),a.jsx(g,{children:"Aksi"})]})}),a.jsx(X,{children:p.pages&&p.pages.flatMap(e=>e.data.data).map(({created_at:e,id:t,mapel:j},C)=>a.jsxs(T,{children:[a.jsx(f,{className:"font-medium",children:C+1}),a.jsx(f,{children:j}),a.jsx(f,{children:I(e)}),a.jsxs(f,{className:"flex  items-center gap-2 flex-wrap",children:[a.jsx(d,{onClick:()=>{l(!0),H({id:t,mapel:j})},children:"Edit"}),a.jsx(d,{onClick:()=>Q.mutate(t),variant:"destructive",children:"Hapus"})]})]},t))})]}),q&&a.jsx(_,{text:`${D?"Loading...":"Load More"}`,loading:D,onClick:$,disabled:D}),a.jsx(ea,{isDialogOpen:s,setIsDialogOpen:l,data:G,mutate:R})]})},Ma=aa(sa);export{Ma as default};
